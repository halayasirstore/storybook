<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" >
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Storytelling Management Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --level1-color: #4283215696;
            --level2-color: #4280391411;
            --level3-color: #4294940672;
            --success-color: #10b981;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --info-color: #3b82f6;
            --dark-bg: #1f2937;
            --light-bg: #f9fafb;
            --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --hover-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #374151;
            line-height: 1.6;
            min-height: 100vh;
            position: relative;
        }
        
        /* Animated Background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="none"/><path d="M0,0L100,100M100,0L0,100" stroke="rgba(102, 126, 234, 0.03)" stroke-width="1"/></svg>');
            background-size: 100px 100px;
            z-index: -1;
            animation: backgroundMove 20s linear infinite;
        }
        
        @keyframes backgroundMove {
            0% { background-position: 0 0; }
            100% { background-position: 100px 100px; }
        }
        
        /* Header Styles */
        .dashboard-header {
            background: var(--primary-gradient);
            color: white;
            padding: 2.5rem 0;
            margin-bottom: 3rem;
            box-shadow: 0 10px 30px -5px rgba(102, 126, 234, 0.3);
            position: relative;
            overflow: hidden;
            border-radius: 0 0 30px 30px;
        }
        
        .dashboard-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.1" d="M0,96L48,112C96,128,192,160,288,160C384,160,480,128,576,122.7C672,117,768,139,864,144C960,149,1056,139,1152,122.7C1248,107,1344,85,1392,74.7L1440,64L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>') no-repeat bottom;
            background-size: cover;
        }
        
        .header-content {
            position: relative;
            z-index: 1;
        }
        
        .header-title {
            font-weight: 800;
            font-size: 2.5rem;
            letter-spacing: -0.5px;
            margin-bottom: 0.5rem;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .header-subtitle {
            font-weight: 400;
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        /* Stats Cards */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }
        
        .stats-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: var(--card-shadow);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 1px solid rgba(255, 255, 255, 0.8);
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }
        
        .stats-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: var(--primary-gradient);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.4s ease;
        }
        
        .stats-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .stats-card:hover::before {
            transform: scaleX(1);
        }
        
        .stats-icon {
            width: 60px;
            height: 60px;
            background: var(--primary-gradient);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
            color: white;
            font-size: 1.5rem;
        }
        
        .stats-number {
            font-size: 3rem;
            font-weight: 800;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
            line-height: 1;
        }
        
        .stats-label {
            color: #6b7280;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 600;
        }
        
        /* Level Cards */
        .levels-container {
            margin-bottom: 3rem;
        }
        
        .level-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            margin-bottom: 2.5rem;
            box-shadow: var(--card-shadow);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.8);
            position: relative;
        }
        
        .level-card::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 150px;
            height: 150px;
            background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, rgba(255,255,255,0) 70%);
            border-radius: 50%;
            transform: translate(50%, -50%);
            z-index: 1;
        }
        
        .level-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .level-header {
            padding: 2rem 2.5rem;
            color: white;
            position: relative;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 2;
        }
        
        .level1-bg {
            background: linear-gradient(135deg, #a8e6cf 0%, #7fcdcd 100%);
        }
        
        .level2-bg {
            background: linear-gradient(135deg, #ffd3b6 0%, #ffaaa5 100%);
        }
        
        .level3-bg {
            background: linear-gradient(135deg, #d4fc79 0%, #96e6a1 100%);
        }
        
        .level-title {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .level-badge {
            background-color: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 0.75rem 1.5rem;
            border-radius: 30px;
            font-size: 0.875rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .level-controls {
            display: flex;
            gap: 0.75rem;
            margin-top: 1.5rem;
            z-index: 2;
        }
        
        .level-content {
            padding: 2.5rem;
        }
        
        /* Story Cards */
        .story-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 2rem;
        }
        
        .story-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 1px solid rgba(255, 255, 255, 0.8);
            height: 100%;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }
        
        .story-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.1) 100%);
            opacity: 0;
            transition: opacity 0.4s ease;
            pointer-events: none;
            z-index: 1;
        }
        
        .story-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .story-card:hover::before {
            opacity: 1;
        }
        
        .story-image {
            height: 200px;
            object-fit: cover;
            width: 100%;
            transition: transform 0.6s ease;
        }
        
        .story-card:hover .story-image {
            transform: scale(1.05);
        }
        
        .story-body {
            padding: 2rem;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            position: relative;
            z-index: 2;
        }
        
        .story-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: #1f2937;
        }
        
        .story-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            color: #6b7280;
            font-size: 0.875rem;
        }
        
        .story-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: auto;
        }
        
        .btn-action {
            flex: 1;
            padding: 0.75rem;
            border-radius: 12px;
            border: none;
            font-size: 0.875rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            position: relative;
            overflow: hidden;
            min-width: 100px;
        }
        
        .btn-action::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .btn-action:active::after {
            width: 300px;
            height: 300px;
        }
        
        .btn-play {
            background-color: var(--success-color);
            color: white;
        }
        
        .btn-play:hover {
            background-color: #059669;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.3);
        }
        
        .btn-quiz {
            background-color: var(--info-color);
            color: white;
        }
        
        .btn-quiz:hover {
            background-color: #2563eb;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.3);
        }
        
        .btn-edit {
            background-color: var(--warning-color);
            color: white;
        }
        
        .btn-edit:hover {
            background-color: #d97706;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(245, 158, 11, 0.3);
        }
        
        .btn-delete {
            background-color: var(--danger-color);
            color: white;
        }
        
        .btn-delete:hover {
            background-color: #dc2626;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(239, 68, 68, 0.3);
        }
        
        .btn-add {
            background: var(--primary-gradient);
            color: white;
        }
        
        .btn-add:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        /* Buttons */
        .btn-primary-custom {
            background: var(--primary-gradient);
            color: white;
            border: none;
            padding: 0.875rem 1.75rem;
            border-radius: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(102, 126, 234, 0.3);
        }
        
        .btn-primary-custom:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px -5px rgba(102, 126, 234, 0.4);
        }
        
        /* Modals */
        .modal-header {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-bottom: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 16px 16px 0 0;
            padding: 1.75rem;
            backdrop-filter: blur(10px);
        }
        
        .modal-content {
            border: none;
            border-radius: 20px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            overflow: hidden;
        }
        
        .modal-body {
            padding: 2.5rem;
        }
        
        .form-label {
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: #374151;
        }
        
        .form-control, .form-select {
            border: 1px solid #d1d5db;
            border-radius: 12px;
            padding: 0.75rem 1rem;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
            transform: translateY(-1px);
        }
        
        /* Segment Input */
        .segment-input {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: var(--card-shadow);
            transition: all 0.3s ease;
        }
        
        .segment-input:hover {
            box-shadow: var(--hover-shadow);
        }
        
        .segment-title {
            font-size: 1.125rem;
            font-weight: 700;
            margin-bottom: 1.25rem;
            color: #374151;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .word-translation {
            background: rgba(255, 255, 255, 0.7);
            border-radius: 12px;
            padding: 1.25rem;
            margin-bottom: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.8);
            transition: all 0.3s ease;
        }
        
        .word-translation:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px -3px rgba(0, 0, 0, 0.1);
        }
        
        .word-translation-title {
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: #4b5563;
        }
        
        /* Quiz Input */
        .quiz-input {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: var(--card-shadow);
            transition: all 0.3s ease;
        }
        
        .quiz-input:hover {
            box-shadow: var(--hover-shadow);
        }
        
        .quiz-title {
            font-size: 1.125rem;
            font-weight: 700;
            margin-bottom: 1.25rem;
            color: #374151;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .option-input {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }
        
        .option-label {
            font-weight: 600;
            color: #4b5563;
            min-width: 60px;
        }
        
        .correct-badge {
            background-color: var(--success-color);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            display: none;
        }
        
        .option-input input[type="radio"]:checked + .correct-badge {
            display: inline-block;
        }
        
        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 1.5rem;
            right: 1.5rem;
            z-index: 1050;
        }
        
        .custom-toast {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 1.25rem 1.75rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            animation: slideIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border-left: 4px solid;
            min-width: 300px;
        }
        
        .toast-success {
            border-left-color: var(--success-color);
        }
        
        .toast-error {
            border-left-color: var(--danger-color);
        }
        
        .toast-info {
            border-left-color: var(--info-color);
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(120%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* Footer */
        .footer {
            background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
            color: white;
            padding: 3rem 0;
            margin-top: 4rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .footer a {
            color: #9ca3af;
            text-decoration: none;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .footer a:hover {
            color: white;
            transform: translateY(-2px);
        }
        
        /* Loading Spinner */
        .spinner-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
        }
        
        .custom-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(102, 126, 234, 0.2);
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .story-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-container {
                grid-template-columns: 1fr;
            }
            
            .level-controls {
                flex-wrap: wrap;
            }
            
            .header-title {
                font-size: 2rem;
            }
            
            .dashboard-header {
                padding: 1.5rem 0;
                margin-bottom: 2rem;
            }
            
            .story-actions {
                flex-direction: column;
            }
            
            .btn-action {
                width: 100%;
            }
        }
        
        /* Floating Action Button */
        .fab {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary-gradient);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 25px -5px rgba(102, 126, 234, 0.4);
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .fab:hover {
            transform: translateY(-5px) scale(1.1);
            box-shadow: 0 15px 35px -5px rgba(102, 126, 234, 0.5);
        }
        
        /* Search Bar */
        .search-container {
            position: relative;
            margin-bottom: 2rem;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .search-input {
            width: 100%;
            padding: 1rem 3rem 1rem 1.5rem;
            border-radius: 50px;
            border: 2px solid rgba(255, 255, 255, 0.5);
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }
        
        .search-icon {
            position: absolute;
            right: 1.5rem;
            top: 50%;
            transform: translateY(-50%);
            color: #6b7280;
        }
        
        /* API Settings */
        .api-settings {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: var(--card-shadow);
        }
        
        .api-status {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 30px;
            font-size: 0.875rem;
            font-weight: 600;
        }
        
        .api-status.connected {
            background-color: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
        }
        
        .api-status.disconnected {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
        }
        
        .api-status.testing {
            background-color: rgba(59, 130, 246, 0.1);
            color: var(--info-color);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="dashboard-header">
        <div class="container">
            <div class="header-content">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h1 class="header-title">Storytelling Management Dashboard</h1>
                        <p class="header-subtitle">Professional content management system for interactive stories</p>
                    </div>
                    <div class="col-md-4 text-end">
                        <button class="btn btn-primary-custom btn-lg me-2" onclick="openAddLevelModal()">
                            <i class="bi bi-plus-circle me-2"></i>Add Level
                        </button>
                        <button class="btn btn-light btn-lg me-2" onclick="saveChanges()">
                            <i class="bi bi-cloud-upload me-2"></i>Save Changes
                        </button>
                        <button class="btn btn-light btn-lg" onclick="exportJSON()">
                            <i class="bi bi-download me-2"></i>Export JSON
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mb-5">
        <!-- API Settings -->
        <div class="api-settings">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h4 class="mb-3">API Configuration</h4>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="apiEndpoint" class="form-label">API Endpoint URL</label>
                            <input type="url" class="form-control" id="apiEndpoint" placeholder="https://your-api.com/endpoint" value="https://your-api.com/endpoint">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="apiKey" class="form-label">API Key (Optional)</label>
                            <input type="text" class="form-control" id="apiKey" placeholder="Your API Key">
                        </div>
                    </div>
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input" type="checkbox" id="autoSync" checked>
                        <label class="form-check-label" for="autoSync">Auto-sync changes to API</label>
                    </div>
                </div>
                <div class="col-md-4 text-md-end">
                    <div class="mb-3">
                        <span class="api-status disconnected" id="apiStatus">
                            <i class="bi bi-circle-fill"></i> Not Connected
                        </span>
                    </div>
                    <button class="btn btn-primary-custom me-2" onclick="testApiConnection()">
                        <i class="bi bi-plug me-2"></i>Test Connection
                    </button>
                    <button class="btn btn-outline-secondary" onclick="openApiSettingsModal()">
                        <i class="bi bi-gear me-2"></i>Settings
                    </button>
                </div>
            </div>
        </div>

        <!-- Search Bar -->
        <div class="search-container">
            <input type="text" class="search-input" placeholder="Search stories, levels, or segments..." id="searchInput" onkeyup="performSearch()">
            <i class="bi bi-search search-icon"></i>
        </div>

        <!-- Statistics -->
        <div class="stats-container">
            <div class="stats-card" onclick="showStatsDetail('levels')">
                <div class="stats-icon">
                    <i class="bi bi-layers"></i>
                </div>
                <div class="stats-number" id="totalLevels">3</div>
                <div class="stats-label">Total Levels</div>
            </div>
            <div class="stats-card" onclick="showStatsDetail('stories')">
                <div class="stats-icon">
                    <i class="bi bi-book"></i>
                </div>
                <div class="stats-number" id="totalStories">5</div>
                <div class="stats-label">Total Stories</div>
            </div>
            <div class="stats-card" onclick="showStatsDetail('segments')">
                <div class="stats-icon">
                    <i class="bi bi-file-text"></i>
                </div>
                <div class="stats-number" id="totalSegments">25</div>
                <div class="stats-label">Total Segments</div>
            </div>
            <div class="stats-card" onclick="showStatsDetail('quizzes')">
                <div class="stats-icon">
                    <i class="bi bi-question-circle"></i>
                </div>
                <div class="stats-number" id="totalQuizzes">50</div>
                <div class="stats-label">Total Quizzes</div>
            </div>
        </div>

        <!-- Levels Container -->
        <div class="levels-container" id="levelsContainer">
            <!-- Levels will be dynamically inserted here -->
        </div>
    </main>

    <!-- Floating Action Button -->
    <div class="fab" onclick="openAddStoryModal()">
        <i class="bi bi-plus" style="font-size: 1.5rem;"></i>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Add Level Modal -->
    <div class="modal fade" id="addLevelModal" tabindex="-1" aria-labelledby="addLevelModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addLevelModalLabel">Add New Level</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addLevelForm">
                        <div class="mb-4">
                            <label for="levelName" class="form-label">Level Name</label>
                            <input type="text" class="form-control" id="levelName" required>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-4">
                                <label for="levelColor" class="form-label">Color (Hex)</label>
                                <input type="color" class="form-control form-control-color" id="levelColor" value="#4283215696">
                            </div>
                            <div class="col-md-6 mb-4">
                                <label for="levelGradientStart" class="form-label">Gradient Start (Hex)</label>
                                <input type="color" class="form-control form-control-color" id="levelGradientStart" value="#4283215696">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-4">
                                <label for="levelGradientEnd" class="form-label">Gradient End (Hex)</label>
                                <input type="color" class="form-control form-control-color" id="levelGradientEnd" value="#4283215696">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="addLevel()">Add Level</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Level Modal -->
    <div class="modal fade" id="editLevelModal" tabindex="-1" aria-labelledby="editLevelModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editLevelModalLabel">Edit Level</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editLevelForm">
                        <div class="mb-4">
                            <label for="editLevelName" class="form-label">Level Name</label>
                            <input type="text" class="form-control" id="editLevelName" required>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-4">
                                <label for="editLevelColor" class="form-label">Color (Hex)</label>
                                <input type="color" class="form-control form-control-color" id="editLevelColor">
                            </div>
                            <div class="col-md-6 mb-4">
                                <label for="editLevelGradientStart" class="form-label">Gradient Start (Hex)</label>
                                <input type="color" class="form-control form-control-color" id="editLevelGradientStart">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-4">
                                <label for="editLevelGradientEnd" class="form-label">Gradient End (Hex)</label>
                                <input type="color" class="form-control form-control-color" id="editLevelGradientEnd">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="updateLevel()">Update Level</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Story Modal -->
    <div class="modal fade" id="addStoryModal" tabindex="-1" aria-labelledby="addStoryModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addStoryModalLabel">Add New Story</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addStoryForm">
                        <div class="mb-4">
                            <label for="storyName" class="form-label">Story Name</label>
                            <input type="text" class="form-control" id="storyName" required>
                        </div>
                        <div class="mb-4">
                            <label for="storyImage" class="form-label">Image URL</label>
                            <input type="url" class="form-control" id="storyImage" required>
                        </div>
                        <div class="mb-4">
                            <label for="storyTitle" class="form-label">Story Title</label>
                            <input type="text" class="form-control" id="storyTitle" required>
                        </div>
                        <div class="mb-4">
                            <label for="storyAudio" class="form-label">Audio URL</label>
                            <input type="url" class="form-control" id="storyAudio" required>
                        </div>
                        <div class="mb-4">
                            <label for="storySegments" class="form-label">Number of Segments</label>
                            <input type="number" class="form-control" id="storySegments" min="1" value="1" required>
                        </div>
                        
                        <div id="segmentsContainer">
                            <!-- Segments will be dynamically added here -->
                        </div>
                        
                        <button type="button" class="btn btn-primary-custom mt-3" onclick="addSegmentInput()">
                            <i class="bi bi-plus-circle"></i> Add Segment
                        </button>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="addStory()">Add Story</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Story Modal -->
    <div class="modal fade" id="editStoryModal" tabindex="-1" aria-labelledby="editStoryModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editStoryModalLabel">Edit Story</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editStoryForm">
                        <div class="mb-4">
                            <label for="editStoryName" class="form-label">Story Name</label>
                            <input type="text" class="form-control" id="editStoryName" required>
                        </div>
                        <div class="mb-4">
                            <label for="editStoryImage" class="form-label">Image URL</label>
                            <input type="url" class="form-control" id="editStoryImage" required>
                        </div>
                        <div class="mb-4">
                            <label for="editStoryTitle" class="form-label">Story Title</label>
                            <input type="text" class="form-control" id="editStoryTitle" required>
                        </div>
                        <div class="mb-4">
                            <label for="editStoryAudio" class="form-label">Audio URL</label>
                            <input type="url" class="form-control" id="editStoryAudio" required>
                        </div>
                        <div class="mb-4">
                            <label for="editStorySegments" class="form-label">Number of Segments</label>
                            <input type="number" class="form-control" id="editStorySegments" min="1" required>
                        </div>
                        
                        <div id="editSegmentsContainer">
                            <!-- Segments will be dynamically added here -->
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="updateStory()">Update Story</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Quiz Modal -->
    <div class="modal fade" id="editQuizModal" tabindex="-1" aria-labelledby="editQuizModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editQuizModalLabel">Edit Quiz</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editQuizForm">
                        <div class="mb-4">
                            <label for="editQuizTitle" class="form-label">Quiz Title</label>
                            <input type="text" class="form-control" id="editQuizTitle" required>
                        </div>
                        
                        <div id="quizQuestionsContainer">
                            <!-- Quiz questions will be dynamically added here -->
                        </div>
                        
                        <button type="button" class="btn btn-primary-custom mt-3" onclick="addQuizQuestion()">
                            <i class="bi bi-plus-circle"></i> Add Question
                        </button>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="updateQuiz()">Update Quiz</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteConfirmationModal" tabindex="-1" aria-labelledby="deleteConfirmationModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteConfirmationModalLabel">Confirm Delete</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p id="deleteConfirmationMessage">Are you sure you want to delete this item?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <!-- API Settings Modal -->
    <div class="modal fade" id="apiSettingsModal" tabindex="-1" aria-labelledby="apiSettingsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="apiSettingsModalLabel">API Settings</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-4">
                        <label for="apiEndpointFull" class="form-label">API Endpoint URL</label>
                        <input type="url" class="form-control" id="apiEndpointFull" placeholder="https://your-api.com/endpoint">
                    </div>
                    <div class="mb-4">
                        <label for="apiKeyFull" class="form-label">API Key</label>
                        <input type="text" class="form-control" id="apiKeyFull" placeholder="Your API Key">
                    </div>
                    <div class="mb-4">
                        <label for="apiMethod" class="form-label">HTTP Method</label>
                        <select class="form-select" id="apiMethod">
                            <option value="POST" selected>POST</option>
                            <option value="PUT">PUT</option>
                            <option value="PATCH">PATCH</option>
                        </select>
                    </div>
                    <div class="form-check form-switch mb-4">
                        <input class="form-check-input" type="checkbox" id="autoSyncFull" checked>
                        <label class="form-check-label" for="autoSyncFull">Auto-sync changes to API</label>
                    </div>
                    <div class="form-check form-switch mb-4">
                        <input class="form-check-input" type="checkbox" id="syncOnSave" checked>
                        <label class="form-check-label" for="syncOnSave">Sync when saving changes</label>
                    </div>
                    <div class="mb-4">
                        <label for="syncInterval" class="form-label">Auto-sync Interval (minutes)</label>
                        <input type="number" class="form-control" id="syncInterval" min="1" value="5">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveApiSettings()">Save Settings</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5>Storytelling Management Dashboard</h5>
                    <p class="mb-4">Professional content management system for interactive stories. All changes are automatically synced with your application.</p>
                    <button class="btn btn-sm btn-outline-light" onclick="openTranslationSettings()">
                        <i class="bi bi-translate me-2"></i>Translation Settings
                    </button>
                </div>
                <div class="col-md-6 text-md-end">
                    <p><a href="#" onclick="importJSON()">Import JSON</a> | <a href="#" onclick="resetData()">Reset Data</a></p>
                    <p class="mb-0">© 2023 Story App Dashboard. All rights reserved.</p>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Initialize data
        let storyData = {
            "levels": [
                {
                    "name": "Level 1: Beginner Stories",
                    "color": 4283215696,
                    "gradient": {
                        "colors": [4283215696, 4283215696]
                    },
                    "stories": [
                        {
                            "name": "The Lost Key 100s",
                            "image": "https://raw.githubusercontent.com/halayasirstore/pictureStories/refs/heads/main/Copilot_20251024_205228.png",
                            "story": {
                                "coverImage": "https://raw.githubusercontent.com/halayasirstore/pictureStories/refs/heads/main/Copilot_20251024_205228.png",
                                "title": "The Mystery of the Lost Key",
                                "segments": 5,
                                "audio": "https://ia600601.us.archive.org/27/items/eleven-labs-2025-10-05-t-16-21-49-ghizlane-moroccan-darija-dialect-pvc-sp-100-s-50-sb-30-v-3/ElevenLabs_2025-10-05T16_21_49_Ghizlane%20-%20Moroccan%20Darija%20Dialect_pvc_sp100_s50_sb30_v3.mp3",
                                "segmentsList": [
                                    {
                                        "segmentTitle": "The Discovery",
                                        "segmentImage": "https://t3.ftcdn.net/jpg/06/01/17/18/360_F_601171827_GwbDHEuhisbGFXRfIpXFhtf7wAvsbLut.jpg",
                                        "segmentAudio": "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3",
                                        "duration": "00:00",
                                        "translation": {
                                            "arabic": "الاكتشاف",
                                            "french": "La Découverte"
                                        },
                                        "content": "Elara lived inside the light. Not in the beam, of course, but in the spiraling white tower of the Mirkwood Lighthouse, ",
                                        "contentTranslation": {
                                            "arabic": "عاشت إلارا داخل الضوء. ليس في الشعاع، بالطبع، ولكن في البرج الأبيض المتعرج من منارة ميرك وود، المت perched على إبهام من الصخور التي تبرز في المحيط المضطرب. كانت في السابعة والعشرين من عمرها، وحيدة، وكانت تعرف الإيقاع المحدد لكل كسر موجة لمسافة مئتي ميل.",
                                            "french": "Elara vivait à l'intérieur de la lumière. Pas dans le faisceau, bien sûr, mais dans la tour blanche en spirale du phare de Mirkwood, perchée sur un pouce de roche qui avançait dans l'océan agité. Elle avait vingt-sept ans, était solitaire et connaissait le rythme spécifique de chaque rupture de vague sur deux cents miles."
                                        },
                                        "wordTranslations": [
                                            {
                                                "word": "walking",
                                                "arabic": "يمشي",
                                                "french": "marcher"
                                            },
                                            {
                                                "word": "forest", 
                                                "arabic": "غابة",
                                                "french": "forêt"
                                            },
                                            {
                                                "word": "shiny",
                                                "arabic": "لامع",
                                                "french": "brillant"
                                            },
                                            {
                                                "word": "oak tree",
                                                "arabic": "شجرة البلوط",
                                                "french": "chêne"
                                            },
                                            {
                                                "word": "noticed",
                                                "arabic": "لاحظ",
                                                "french": "remarqué"
                                            }
                                        ]
                                    }
                                ]
                            },
                            "quiz": {
                                "title": "The Lost Key Quiz",
                                "questions": [
                                    {
                                        "question": "Where was the shiny object found?",
                                        "options": ["Under an oak tree", "On a mountain", "In a river", "On a bench"],
                                        "correctAnswer": 0,
                                        "explanation": "The story mentions the shiny object was found under the oak tree."
                                    },
                                    {
                                        "question": "What did Elara see in the lighthouse?",
                                        "options": ["A beam of light", "A spiral staircase", "A secret room", "A treasure chest"],
                                        "correctAnswer": 1,
                                        "explanation": "The story describes a spiraling white tower."
                                    }
                                ]
                            }
                        },
                        {
                            "name": "The Secret Garden",
                            "image": "https://t3.ftcdn.net/jpg/06/01/17/18/360_F_601171827_GwbDHEuhisbGFXRfIpXFhtf7wAvsbLut.jpg",
                            "story": {
                                "coverImage": "https://t3.ftcdn.net/jpg/06/01/17/18/360_F_601171827_GwbDHEuhisbGFXRfIpXFhtf7wAvsbLut.jpg",
                                "title": "The Hidden Garden",
                                "segments": 4,
                                "audio": "assets/audio/stories/secret_garden_full.mp3",
                                "segmentsList": [
                                    {
                                        "segmentTitle": "The Old Gate",
                                        "segmentImage": "https://t3.ftcdn.net/jpg/06/01/17/18/360_F_601171827_GwbDHEuhisbGFXRfIpXFhtf7wAvsbLut.jpg",
                                        "segmentAudio": "assets/audio/segments/garden_1.mp3",
                                        "duration": "3:15",
                                        "translation": {
                                            "arabic": "البوابة القديمة",
                                            "french": "La Vieille Porte"
                                        },
                                        "content": "Behind the old stone wall, there was a rusty iron gate that nobody had opened for years. The key was hidden under a flower pot nearby.",
                                        "contentTranslation": {
                                            "arabic": "خلف جدار الحجر القديم، كانت هناك بوابة حديدية صدئة لم يفتحها أحد لسنوات. كان المفتاح مختبئًا تحت أصيص زهور قريب.",
                                            "french": "Derrière le vieux mur de pierre, il y avait une porte en fer rouillée que personne n'avait ouverte depuis des années. La clé était cachée sous un pot de fleurs à proximité."
                                        },
                                        "wordTranslations": [
                                            {
                                                "word": "stone wall",
                                                "arabic": "جدار حجري",
                                                "french": "mur de pierre"
                                            },
                                            {
                                                "word": "rusty",
                                                "arabic": "صدئ",
                                                "french": "rouillé"
                                            },
                                            {
                                                "word": "iron gate",
                                                "arabic": "بوابة حديدية",
                                                "french": "porte en fer"
                                            },
                                            {
                                                "word": "hidden",
                                                "arabic": "مختبئ",
                                                "french": "caché"
                                            },
                                            {
                                                "word": "flower pot",
                                                "arabic": "أصيص زهور",
                                                "french": "pot de fleurs"
                                            }
                                        ]
                                    }
                                ]
                            },
                            "quiz": {
                                "title": "Secret Garden Quiz",
                                "questions": [
                                    {
                                        "question": "Where was the hidden garden located?",
                                        "options": ["Behind a stone wall", "On a mountain", "In a cave", "Under a bridge"],
                                        "correctAnswer": 0,
                                        "explanation": "The garden was behind an old stone wall."
                                    }
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "Level 2: Intermediate Tales",
                    "color": 4280391411,
                    "gradient": {
                        "colors": [4286381056, 4282615280]
                    },
                    "stories": [
                        {
                            "name": "Mountain Quest",
                            "image": "https://i.imgur.com/gsVVrKB.jpeg",
                            "story": {
                                "coverImage": "https://i.imgur.com/HhZJ2Oc.jpeg",
                                "title": "The Dragon's Peak",
                                "segments": 3,
                                "audio": "assets/audio/stories/mountain_quest_full.mp3",
                                "segmentsList": [
                                    {
                                        "segmentTitle": "The Call to Adventure",
                                        "segmentImage": "https://i.imgur.com/7Z1X8W9.jpeg",
                                        "segmentAudio": "assets/audio/segments/mountain_1.mp3",
                                        "duration": "4:15",
                                        "translation": {
                                            "arabic": "نداء المغامرة",
                                            "french": "L'Appel de l'Aventure"
                                        },
                                        "content": "The village elder told us about the legendary dragon that lived atop the highest mountain peak. The village elder told us about the legendary dragon that lived atop the highest mountain peak.",
                                        "contentTranslation": {
                                            "arabic": "أخبرنا شيخ القرية عن التنين الأسطوري الذي يعيش على قمة أعلى جبل.",
                                            "french": "L'ancien du village nous a parlé du dragon légendaire qui vivait au sommet de la plus haute montagne."
                                        },
                                        "wordTranslations": [
                                            {
                                                "word": "village",
                                                "arabic": "قرية",
                                                "french": "village"
                                            },
                                            {
                                                "word": "elder",
                                                "arabic": "شيخ",
                                                "french": "ancien"
                                            },
                                            {
                                                "word": "legendary",
                                                "arabic": "أسطوري",
                                                "french": "légendaire"
                                            },
                                            {
                                                "word": "dragon",
                                                "arabic": "تنين",
                                                "french": "dragon"
                                            },
                                            {
                                                "word": "peak",
                                                "arabic": "قمة",
                                                "french": "sommet"
                                            }
                                        ]
                                    }
                                ]
                            },
                            "quiz": {
                                "title": "Dragon's Peak Quiz",
                                "questions": [
                                    {
                                        "question": "Who told the characters about the dragon?",
                                        "options": ["The village elder", "A friend", "A book", "A stranger"],
                                        "correctAnswer": 0,
                                        "explanation": "The village elder shared information about the dragon."
                                    }
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "Level 3: Advanced Narratives",
                    "color": 4294940672,
                    "gradient": {
                        "colors": [4294945280, 4294932224]
                    },
                    "stories": [
                        {
                            "name": "Time Traveler",
                            "image": "assets/images/stories/time_traveler.jpg",
                            "story": {
                                "coverImage": "assets/images/covers/time_cover.jpg",
                                "title": "Chronos Paradox",
                                "segments": 3,
                                "audio": "assets/audio/stories/time_traveler_full.mp3",
                                "segmentsList": [
                                    {
                                        "segmentTitle": "The Invention",
                                        "segmentImage": "https://i.imgur.com/0C4D5E6.jpeg",
                                        "segmentAudio": "assets/audio/segments/time_1.mp3",
                                        "duration": "5:20",
                                        "translation": {
                                            "arabic": "الاختراع",
                                            "french": "L'Invention"
                                        },
                                        "content": "After years of research, Professor Elara finally completed her temporal displacement device.",
                                        "contentTranslation": {
                                            "arabic": "بعد سنوات من البحث، أكملت البروفيسورة إلارا أخيرًا جهاز الانزياح الزمني الخاص بها.",
                                            "french": "Après des années de recherche, le professeur Elara a finalement terminé son dispositif de déplacement temporel."
                                        },
                                        "wordTranslations": [
                                            {
                                                "word": "research",
                                                "arabic": "بحث",
                                                "french": "recherche"
                                            },
                                            {
                                                "word": "professor",
                                                "arabic": "أستاذ",
                                                "french": "professeur"
                                            },
                                            {
                                                "word": "completed",
                                                "arabic": "أكمل",
                                                "french": "terminé"
                                            },
                                            {
                                                "word": "temporal",
                                                "arabic": "زمني",
                                                "french": "temporel"
                                            },
                                            {
                                                "word": "device",
                                                "arabic": "جهاز",
                                                "french": "dispositif"
                                            }
                                        ]
                                    }
                                ]
                            },
                            "quiz": {
                                "title": "Time Travel Quiz",
                                "questions": [
                                    {
                                        "question": "Who created the time machine?",
                                        "options": ["Professor Elara", "A student", "An engineer", "A scientist"],
                                        "correctAnswer": 0,
                                        "explanation": "Professor Elara completed the temporal displacement device."
                                    }
                                ]
                            }
                        }
                    ]
                }
            ]
        };

        let currentLevelIndex = null;
        let currentStoryIndex = null;
        let currentEditLevelIndex = null;
        let currentEditStoryIndex = null;
        let searchTerm = '';
        let apiSettings = {
            endpoint: 'https://your-api.com/endpoint',
            key: '',
            method: 'POST',
            autoSync: true,
            syncOnSave: true,
            syncInterval: 5
        };
        let syncIntervalId = null;

        // Toast notification function
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toastContainer');
            const toastId = 'toast-' + Date.now();
            
            const toastHTML = `
                <div id="${toastId}" class="custom-toast toast-${type}">
                    <i class="bi bi-${type === 'success' ? 'check-circle' : type === 'error' ? 'x-circle' : 'info-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;
            
            toastContainer.insertAdjacentHTML('beforeend', toastHTML);
            
            setTimeout(() => {
                const toast = document.getElementById(toastId);
                if (toast) {
                    toast.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => toast.remove(), 300);
                }
            }, 3000);
        }

        // API Functions
        function updateApiStatus(status, message = '') {
            const apiStatus = document.getElementById('apiStatus');
            apiStatus.className = `api-status ${status}`;
            
            switch(status) {
                case 'connected':
                    apiStatus.innerHTML = '<i class="bi bi-circle-fill"></i> Connected';
                    if (message) showToast(message, 'success');
                    break;
                case 'disconnected':
                    apiStatus.innerHTML = '<i class="bi bi-circle-fill"></i> Not Connected';
                    if (message) showToast(message, 'error');
                    break;
                case 'testing':
                    apiStatus.innerHTML = '<i class="bi bi-circle-fill"></i> Testing Connection';
                    break;
            }
        }

        function testApiConnection() {
            const endpoint = document.getElementById('apiEndpoint').value;
            const apiKey = document.getElementById('apiKey').value;
            
            if (!endpoint) {
                showToast('Please enter an API endpoint URL', 'error');
                return;
            }
            
            updateApiStatus('testing');
            
            // Test connection with a simple HEAD request
            fetch(endpoint, {
                method: 'HEAD',
                headers: apiKey ? { 'Authorization': `Bearer ${apiKey}` } : {}
            })
            .then(response => {
                if (response.ok) {
                    updateApiStatus('connected', 'API connection successful!');
                    saveApiSettings();
                } else {
                    updateApiStatus('disconnected', 'API endpoint responded with an error');
                }
            })
            .catch(error => {
                console.error('API connection error:', error);
                updateApiStatus('disconnected', 'Failed to connect to API endpoint');
            });
        }

        function sendDataToAPI(data, action = 'update') {
            const endpoint = apiSettings.endpoint;
            if (!endpoint || endpoint === 'https://your-api.com/endpoint') {
                console.log('API endpoint not configured');
                return Promise.resolve();
            }
            
            const payload = {
                action: action,
                timestamp: new Date().toISOString(),
                data: data
            };
            
            const headers = {
                'Content-Type': 'application/json'
            };
            
            if (apiSettings.key) {
                headers['Authorization'] = `Bearer ${apiSettings.key}`;
            }
            
            return fetch(endpoint, {
                method: apiSettings.method,
                headers: headers,
                body: JSON.stringify(payload)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                console.log('Data sent to API successfully:', data);
                return data;
            })
            .catch(error => {
                console.error('Error sending data to API:', error);
                showToast('Failed to sync data with API', 'error');
                throw error;
            });
        }

        function autoSyncData() {
            if (apiSettings.autoSync) {
                console.log('Auto-syncing data with API...');
                sendDataToAPI(storyData, 'auto-sync')
                    .then(() => {
                        console.log('Auto-sync completed');
                    })
                    .catch(error => {
                        console.error('Auto-sync failed:', error);
                    });
            }
        }

        function saveApiSettings() {
            apiSettings.endpoint = document.getElementById('apiEndpoint').value;
            apiSettings.key = document.getElementById('apiKey').value;
            apiSettings.autoSync = document.getElementById('autoSync').checked;
            
            // Save to localStorage
            localStorage.setItem('storyDashboardApiSettings', JSON.stringify(apiSettings));
            
            // Set up auto-sync interval
            if (syncIntervalId) {
                clearInterval(syncIntervalId);
            }
            
            if (apiSettings.autoSync) {
                const intervalMs = apiSettings.syncInterval * 60 * 1000;
                syncIntervalId = setInterval(autoSyncData, intervalMs);
            }
            
            showToast('API settings saved successfully', 'success');
        }

        function loadApiSettings() {
            const savedSettings = localStorage.getItem('storyDashboardApiSettings');
            if (savedSettings) {
                apiSettings = JSON.parse(savedSettings);
                
                document.getElementById('apiEndpoint').value = apiSettings.endpoint;
                document.getElementById('apiKey').value = apiSettings.key;
                document.getElementById('autoSync').checked = apiSettings.autoSync;
                
                // Set up auto-sync if enabled
                if (apiSettings.autoSync) {
                    const intervalMs = apiSettings.syncInterval * 60 * 1000;
                    syncIntervalId = setInterval(autoSyncData, intervalMs);
                }
            }
        }

        function openApiSettingsModal() {
            document.getElementById('apiEndpointFull').value = apiSettings.endpoint;
            document.getElementById('apiKeyFull').value = apiSettings.key;
            document.getElementById('apiMethod').value = apiSettings.method;
            document.getElementById('autoSyncFull').checked = apiSettings.autoSync;
            document.getElementById('syncOnSave').checked = apiSettings.syncOnSave;
            document.getElementById('syncInterval').value = apiSettings.syncInterval;
            
            const modal = new bootstrap.Modal(document.getElementById('apiSettingsModal'));
            modal.show();
        }

        function saveFullApiSettings() {
            apiSettings.endpoint = document.getElementById('apiEndpointFull').value;
            apiSettings.key = document.getElementById('apiKeyFull').value;
            apiSettings.method = document.getElementById('apiMethod').value;
            apiSettings.autoSync = document.getElementById('autoSyncFull').checked;
            apiSettings.syncOnSave = document.getElementById('syncOnSave').checked;
            apiSettings.syncInterval = parseInt(document.getElementById('syncInterval').value);
            
            // Update main API settings display
            document.getElementById('apiEndpoint').value = apiSettings.endpoint;
            document.getElementById('apiKey').value = apiSettings.key;
            document.getElementById('autoSync').checked = apiSettings.autoSync;
            
            saveApiSettings();
            bootstrap.Modal.getInstance(document.getElementById('apiSettingsModal')).hide();
        }

        // Function to render levels
        function renderLevels() {
            const container = document.getElementById('levelsContainer');
            container.innerHTML = '';
            
            storyData.levels.forEach((level, index) => {
                const levelClass = `level${(index % 3) + 1}`;
                
                let levelHTML = `
                    <div class="level-card">
                        <div class="level-header ${levelClass}-bg">
                            <div>
                                <h2 class="level-title">${level.name}</h2>
                                <span class="level-badge"><i class="bi bi-book me-2"></i>${level.stories.length} stories</span>
                            </div>
                            <div class="level-controls">
                                <button class="btn btn-light btn-sm" onclick="addStoryToLevel(${index})">
                                    <i class="bi bi-plus-circle"></i> Add Story
                                </button>
                                <button class="btn btn-light btn-sm" onclick="editLevel(${index})">
                                    <i class="bi bi-pencil"></i> Edit
                                </button>
                                <button class="btn btn-light btn-sm" onclick="confirmDeleteLevel(${index})">
                                    <i class="bi bi-trash"></i> Remove Level
                                </button>
                            </div>
                        </div>
                        <div class="level-content">
                            <div class="story-grid">
                `;
                
                level.stories.forEach((story, storyIndex) => {
                    if (searchTerm === '' || 
                        story.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        story.story.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        story.story.segmentsList.some(segment => 
                            segment.content.toLowerCase().includes(searchTerm.toLowerCase()) ||
                            segment.translation.arabic.toLowerCase().includes(searchTerm.toLowerCase()) ||
                            segment.translation.french.toLowerCase().includes(searchTerm.toLowerCase())
                        )) {
                        levelHTML += `
                            <div class="story-card">
                                <img src="${story.image}" class="story-image" alt="${story.name}">
                                <div class="story-body">
                                    <h3 class="story-title">${story.story.title}</h3>
                                    <div class="story-meta">
                                        <span><i class="bi bi-collection-play"></i> ${story.story.segments} segments</span>
                                        <span><i class="bi bi-globe"></i> ${story.story.segmentsList.length} translations</span>
                                        <span><i class="bi bi-question-circle"></i> ${story.quiz.questions.length} questions</span>
                                    </div>
                                    <div class="story-actions">
                                        <button class="btn-action btn-play" onclick="playStory('${level.name}', '${story.name}')">
                                            <i class="bi bi-play-fill"></i> Play
                                        </button>
                                        <button class="btn-action btn-quiz" onclick="takeQuiz('${level.name}', '${story.name}')">
                                            <i class="bi bi-question-circle"></i> Quiz
                                        </button>
                                        <button class="btn-action btn-edit" onclick="editStory(${index}, ${storyIndex})">
                                            <i class="bi bi-pencil"></i> Edit
                                        </button>
                                        <button class="btn-action btn-edit" onclick="editQuiz(${index}, ${storyIndex})">
                                            <i class="bi bi-pencil-square"></i> Edit Quiz
                                        </button>
                                        <button class="btn-action btn-delete" onclick="confirmDeleteStory(${index}, ${storyIndex})">
                                            <i class="bi bi-trash"></i> Delete
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                });
                
                levelHTML += `
                            </div>
                        </div>
                    </div>
                `;
                
                container.innerHTML += levelHTML;
            });
            
            updateStats();
        }

        // Function to update statistics
        function updateStats() {
            document.getElementById('totalLevels').textContent = storyData.levels.length;
            
            let totalStories = 0;
            let totalSegments = 0;
            let totalQuizzes = 0;
            
            storyData.levels.forEach(level => {
                totalStories += level.stories.length;
                level.stories.forEach(story => {
                    totalSegments += story.story.segments;
                    totalQuizzes += story.quiz.questions.length;
                });
            });
            
            document.getElementById('totalStories').textContent = totalStories;
            document.getElementById('totalSegments').textContent = totalSegments;
            document.getElementById('totalQuizzes').textContent = totalQuizzes;
        }

        // Show stats detail
        function showStatsDetail(type) {
            let message = '';
            switch(type) {
                case 'levels':
                    message = `You have ${storyData.levels.length} levels in your dashboard. Levels help organize your stories by difficulty.`;
                    break;
                case 'stories':
                    let totalStories = 0;
                    storyData.levels.forEach(level => {
                        totalStories += level.stories.length;
                    });
                    message = `You have ${totalStories} stories across all levels. Each story contains multiple segments and quizzes.`;
                    break;
                case 'segments':
                    let totalSegments = 0;
                    storyData.levels.forEach(level => {
                        level.stories.forEach(story => {
                            totalSegments += story.story.segments;
                        });
                    });
                    message = `You have ${totalSegments} story segments in total. Each segment includes content in multiple languages.`;
                    break;
                case 'quizzes':
                    let totalQuizzes = 0;
                    storyData.levels.forEach(level => {
                        level.stories.forEach(story => {
                            totalQuizzes += story.quiz.questions.length;
                        });
                    });
                    message = `You have ${totalQuizzes} quiz questions across all stories. These help test user comprehension.`;
                    break;
            }
            showToast(message, 'info');
        }

        // Search functionality
        function performSearch() {
            searchTerm = document.getElementById('searchInput').value;
            renderLevels();
        }

        // Level Management Functions
        function addLevel() {
            const name = document.getElementById('levelName').value;
            const color = parseInt(document.getElementById('levelColor').value.replace('#', ''), 16);
            const gradientStart = parseInt(document.getElementById('levelGradientStart').value.replace('#', ''), 16);
            const gradientEnd = parseInt(document.getElementById('levelGradientEnd').value.replace('#', ''), 16);
            
            const newLevel = {
                name: name,
                color: color,
                gradient: {
                    colors: [gradientStart, gradientEnd]
                },
                stories: []
            };
            
            storyData.levels.push(newLevel);
            renderLevels();
            
            // Reset form and close modal
            document.getElementById('addLevelForm').reset();
            bootstrap.Modal.getInstance(document.getElementById('addLevelModal')).hide();
            
            showToast(`Level "${name}" added successfully!`, 'success');
            
            // Sync with API if enabled
            if (apiSettings.syncOnSave) {
                sendDataToAPI(storyData, 'add-level')
                    .then(() => showToast('Changes synced with API', 'success'))
                    .catch(error => console.error('Sync failed:', error));
            }
        }

        function editLevel(index) {
            currentEditLevelIndex = index;
            const level = storyData.levels[index];
            
            document.getElementById('editLevelName').value = level.name;
            document.getElementById('editLevelColor').value = '#' + level.color.toString(16);
            document.getElementById('editLevelGradientStart').value = '#' + level.gradient.colors[0].toString(16);
            document.getElementById('editLevelGradientEnd').value = '#' + level.gradient.colors[1].toString(16);
            
            const modal = new bootstrap.Modal(document.getElementById('editLevelModal'));
            modal.show();
        }

        function updateLevel() {
            const level = storyData.levels[currentEditLevelIndex];
            
            level.name = document.getElementById('editLevelName').value;
            level.color = parseInt(document.getElementById('editLevelColor').value.replace('#', ''), 16);
            level.gradient.colors = [
                parseInt(document.getElementById('editLevelGradientStart').value.replace('#', ''), 16),
                parseInt(document.getElementById('editLevelGradientEnd').value.replace('#', ''), 16)
            ];
            
            renderLevels();
            bootstrap.Modal.getInstance(document.getElementById('editLevelModal')).hide();
            
            showToast(`Level "${level.name}" updated successfully!`, 'success');
            
            // Sync with API if enabled
            if (apiSettings.syncOnSave) {
                sendDataToAPI(storyData, 'update-level')
                    .then(() => showToast('Changes synced with API', 'success'))
                    .catch(error => console.error('Sync failed:', error));
            }
        }

        function confirmDeleteLevel(index) {
            const level = storyData.levels[index];
            document.getElementById('deleteConfirmationMessage').textContent = 
                `Are you sure you want to delete "${level.name}" and all its stories?`;
            
            document.getElementById('confirmDeleteBtn').onclick = () => deleteLevel(index);
            
            const modal = new bootstrap.Modal(document.getElementById('deleteConfirmationModal'));
            modal.show();
        }

        function deleteLevel(index) {
            storyData.levels.splice(index, 1);
            renderLevels();
            bootstrap.Modal.getInstance(document.getElementById('deleteConfirmationModal')).hide();
            
            showToast('Level deleted successfully!', 'success');
            
            // Sync with API if enabled
            if (apiSettings.syncOnSave) {
                sendDataToAPI(storyData, 'delete-level')
                    .then(() => showToast('Changes synced with API', 'success'))
                    .catch(error => console.error('Sync failed:', error));
            }
        }

        function addStoryToLevel(levelIndex) {
            currentLevelIndex = levelIndex;
            document.getElementById('addStoryForm').reset();
            document.getElementById('segmentsContainer').innerHTML = '';
            
            // Add initial segment
            addSegmentInput();
            
            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('addStoryModal'));
            modal.show();
        }

        // Story Management Functions
        function addStory() {
            const name = document.getElementById('storyName').value;
            const image = document.getElementById('storyImage').value;
            const title = document.getElementById('storyTitle').value;
            const audio = document.getElementById('storyAudio').value;
            const segmentsCount = parseInt(document.getElementById('storySegments').value);
            
            // Collect segment data
            const segmentsList = [];
            for (let i = 0; i < segmentsCount; i++) {
                const segmentTitle = document.getElementById(`segmentTitle-${i}`).value;
                const segmentImage = document.getElementById(`segmentImage-${i}`).value;
                const segmentAudio = document.getElementById(`segmentAudio-${i}`).value;
                const segmentDuration = document.getElementById(`segmentDuration-${i}`).value;
                const segmentContent = document.getElementById(`segmentContent-${i}`).value;
                const segmentArabic = document.getElementById(`segmentArabic-${i}`).value;
                const segmentFrench = document.getElementById(`segmentFrench-${i}`).value;
                
                // Collect word translations
                const wordTranslations = [];
                const wordContainer = document.getElementById(`wordTranslations-${i}`);
                const wordElements = wordContainer.children;
                
                for (let j = 0; j < wordElements.length; j++) {
                    const word = document.getElementById(`word-${i}-${j}`).value;
                    const wordArabic = document.getElementById(`wordArabic-${i}-${j}`).value;
                    const wordFrench = document.getElementById(`wordFrench-${i}-${j}`).value;
                    
                    if (word && wordArabic && wordFrench) {
                        wordTranslations.push({
                            word: word,
                            arabic: wordArabic,
                            french: wordFrench
                        });
                    }
                }
                
                segmentsList.push({
                    segmentTitle: segmentTitle,
                    segmentImage: segmentImage,
                    segmentAudio: segmentAudio,
                    duration: segmentDuration,
                    translation: {
                        arabic: segmentArabic,
                        french: segmentFrench
                    },
                    content: segmentContent,
                    contentTranslation: {
                        arabic: segmentArabic,
                        french: segmentFrench
                    },
                    wordTranslations: wordTranslations
                });
            }
            
            // Create quiz questions
            const quizQuestions = [];
            for (let i = 0; i < 10; i++) {
                quizQuestions.push({
                    question: `Question ${i + 1} for ${name}`,
                    options: ["Option 1", "Option 2", "Option 3", "Option 4"],
                    correctAnswer: 0,
                    explanation: "Explanation for the answer"
                });
            }
            
            const newStory = {
                name: name,
                image: image,
                story: {
                    coverImage: image,
                    title: title,
                    segments: segmentsCount,
                    audio: audio,
                    segmentsList: segmentsList
                },
                quiz: {
                    title: `${title} Quiz`,
                    questions: quizQuestions
                }
            };
            
            storyData.levels[currentLevelIndex].stories.push(newStory);
            renderLevels();
            
            // Close modal
            bootstrap.Modal.getInstance(document.getElementById('addStoryModal')).hide();
            
            showToast(`Story "${name}" added successfully to ${storyData.levels[currentLevelIndex].name}!`, 'success');
            
            // Sync with API if enabled
            if (apiSettings.syncOnSave) {
                sendDataToAPI(storyData, 'add-story')
                    .then(() => showToast('Changes synced with API', 'success'))
                    .catch(error => console.error('Sync failed:', error));
            }
        }

        function editStory(levelIndex, storyIndex) {
            currentEditLevelIndex = levelIndex;
            currentEditStoryIndex = storyIndex;
            const story = storyData.levels[levelIndex].stories[storyIndex];
            
            document.getElementById('editStoryName').value = story.name;
            document.getElementById('editStoryImage').value = story.image;
            document.getElementById('editStoryTitle').value = story.story.title;
            document.getElementById('editStoryAudio').value = story.story.audio;
            document.getElementById('editStorySegments').value = story.story.segments;
            
            // Populate segments
            document.getElementById('editSegmentsContainer').innerHTML = '';
            story.story.segmentsList.forEach((segment, segIndex) => {
                addEditSegmentInput(segment, segIndex);
            });
            
            const modal = new bootstrap.Modal(document.getElementById('editStoryModal'));
            modal.show();
        }

        function addEditSegmentInput(segment, index) {
            const container = document.getElementById('editSegmentsContainer');
            
            const segmentHTML = `
                <div class="segment-input" id="editSegment-${index}">
                    <h5 class="segment-title">
                        <i class="bi bi-file-text me-2"></i>Segment ${index + 1}
                    </h5>
                    <div class="mb-3">
                        <label for="editSegmentTitle-${index}" class="form-label">Segment Title</label>
                        <input type="text" class="form-control" id="editSegmentTitle-${index}" value="${segment.segmentTitle}" required>
                    </div>
                    <div class="mb-3">
                        <label for="editSegmentImage-${index}" class="form-label">Segment Image URL</label>
                        <input type="url" class="form-control" id="editSegmentImage-${index}" value="${segment.segmentImage}" required>
                    </div>
                    <div class="mb-3">
                        <label for="editSegmentAudio-${index}" class="form-label">Segment Audio URL</label>
                        <input type="url" class="form-control" id="editSegmentAudio-${index}" value="${segment.segmentAudio}" required>
                    </div>
                    <div class="mb-3">
                        <label for="editSegmentDuration-${index}" class="form-label">Duration (e.g., 2:30)</label>
                        <input type="text" class="form-control" id="editSegmentDuration-${index}" value="${segment.duration}" required>
                    </div>
                    <div class="mb-3">
                        <label for="editSegmentContent-${index}" class="form-label">Content</label>
                        <textarea class="form-control" id="editSegmentContent-${index}" rows="3" required>${segment.content}</textarea>
                    </div>
                    <div class="mb-3">
                        <label for="editSegmentArabic-${index}" class="form-label">Arabic Translation</label>
                        <textarea class="form-control" id="editSegmentArabic-${index}" rows="3" required>${segment.contentTranslation.arabic}</textarea>
                    </div>
                    <div class="mb-3">
                        <label for="editSegmentFrench-${index}" class="form-label">French Translation</label>
                        <textarea class="form-control" id="editSegmentFrench-${index}" rows="3" required>${segment.contentTranslation.french}</textarea>
                    </div>
                </div>
            `;
            
            container.insertAdjacentHTML('beforeend', segmentHTML);
        }

        function updateStory() {
            const story = storyData.levels[currentEditLevelIndex].stories[currentEditStoryIndex];
            
            story.name = document.getElementById('editStoryName').value;
            story.image = document.getElementById('editStoryImage').value;
            story.story.title = document.getElementById('editStoryTitle').value;
            story.story.audio = document.getElementById('editStoryAudio').value;
            story.story.segments = parseInt(document.getElementById('editStorySegments').value);
            
            // Update segments
            const segmentsList = [];
            for (let i = 0; i < story.story.segments; i++) {
                const segmentTitle = document.getElementById(`editSegmentTitle-${i}`).value;
                const segmentImage = document.getElementById(`editSegmentImage-${i}`).value;
                const segmentAudio = document.getElementById(`editSegmentAudio-${i}`).value;
                const segmentDuration = document.getElementById(`editSegmentDuration-${i}`).value;
                const segmentContent = document.getElementById(`editSegmentContent-${i}`).value;
                const segmentArabic = document.getElementById(`editSegmentArabic-${i}`).value;
                const segmentFrench = document.getElementById(`editSegmentFrench-${i}`).value;
                
                segmentsList.push({
                    segmentTitle: segmentTitle,
                    segmentImage: segmentImage,
                    segmentAudio: segmentAudio,
                    duration: segmentDuration,
                    translation: {
                        arabic: segmentArabic,
                        french: segmentFrench
                    },
                    content: segmentContent,
                    contentTranslation: {
                        arabic: segmentArabic,
                        french: segmentFrench
                    },
                    wordTranslations: [] // Keep existing word translations
                });
            }
            
            story.story.segmentsList = segmentsList;
            
            renderLevels();
            bootstrap.Modal.getInstance(document.getElementById('editStoryModal')).hide();
            
            showToast(`Story "${story.name}" updated successfully!`, 'success');
            
            // Sync with API if enabled
            if (apiSettings.syncOnSave) {
                sendDataToAPI(storyData, 'update-story')
                    .then(() => showToast('Changes synced with API', 'success'))
                    .catch(error => console.error('Sync failed:', error));
            }
        }

        // Quiz Management Functions
        function editQuiz(levelIndex, storyIndex) {
            currentEditLevelIndex = levelIndex;
            currentEditStoryIndex = storyIndex;
            const story = storyData.levels[levelIndex].stories[storyIndex];
            
            document.getElementById('editQuizTitle').value = story.quiz.title;
            
            // Populate quiz questions
            document.getElementById('quizQuestionsContainer').innerHTML = '';
            story.quiz.questions.forEach((question, qIndex) => {
                addQuizQuestionInput(question, qIndex);
            });
            
            const modal = new bootstrap.Modal(document.getElementById('editQuizModal'));
            modal.show();
        }

        function addQuizQuestionInput(question, index) {
            const container = document.getElementById('quizQuestionsContainer');
            
            const questionHTML = `
                <div class="quiz-input" id="quizQuestion-${index}">
                    <h5 class="quiz-title">
                        <i class="bi bi-question-circle me-2"></i>Question ${index + 1}
                    </h5>
                    <div class="mb-3">
                        <label for="question-${index}" class="form-label">Question Text</label>
                        <textarea class="form-control" id="question-${index}" rows="2" required>${question.question}</textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Options</label>
                        <div class="option-input">
                            <span class="option-label">A:</span>
                            <input type="text" class="form-control" id="option-${index}-0" value="${question.options[0]}" required>
                            <input type="radio" name="correct-${index}" value="0" ${question.correctAnswer === 0 ? 'checked' : ''}>
                            <span class="correct-badge">Correct</span>
                        </div>
                        <div class="option-input">
                            <span class="option-label">B:</span>
                            <input type="text" class="form-control" id="option-${index}-1" value="${question.options[1]}" required>
                            <input type="radio" name="correct-${index}" value="1" ${question.correctAnswer === 1 ? 'checked' : ''}>
                            <span class="correct-badge">Correct</span>
                        </div>
                        <div class="option-input">
                            <span class="option-label">C:</span>
                            <input type="text" class="form-control" id="option-${index}-2" value="${question.options[2]}" required>
                            <input type="radio" name="correct-${index}" value="2" ${question.correctAnswer === 2 ? 'checked' : ''}>
                            <span class="correct-badge">Correct</span>
                        </div>
                        <div class="option-input">
                            <span class="option-label">D:</span>
                            <input type="text" class="form-control" id="option-${index}-3" value="${question.options[3]}" required>
                            <input type="radio" name="correct-${index}" value="3" ${question.correctAnswer === 3 ? 'checked' : ''}>
                            <span class="correct-badge">Correct</span>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="explanation-${index}" class="form-label">Explanation</label>
                        <textarea class="form-control" id="explanation-${index}" rows="2" required>${question.explanation}</textarea>
                    </div>
                    ${index > 0 ? `<button type="button" class="btn btn-sm btn-outline-danger mt-2" onclick="removeQuizQuestion(${index})">Remove Question</button>` : ''}
                </div>
            `;
            
            container.insertAdjacentHTML('beforeend', questionHTML);
        }

        function addQuizQuestion() {
            const container = document.getElementById('quizQuestionsContainer');
            const questionIndex = container.children.length;
            
            const newQuestion = {
                question: `New Question ${questionIndex + 1}`,
                options: ["Option 1", "Option 2", "Option 3", "Option 4"],
                correctAnswer: 0,
                explanation: "Explanation for the answer"
            };
            
            addQuizQuestionInput(newQuestion, questionIndex);
        }

        function removeQuizQuestion(index) {
            const question = document.getElementById(`quizQuestion-${index}`);
            question.remove();
        }

        function updateQuiz() {
            const story = storyData.levels[currentEditLevelIndex].stories[currentEditStoryIndex];
            
            story.quiz.title = document.getElementById('editQuizTitle').value;
            
            // Update quiz questions
            const questions = [];
            const container = document.getElementById('quizQuestionsContainer');
            const questionElements = container.children;
            
            for (let i = 0; i < questionElements.length; i++) {
                const question = {
                    question: document.getElementById(`question-${i}`).value,
                    options: [
                        document.getElementById(`option-${i}-0`).value,
                        document.getElementById(`option-${i}-1`).value,
                        document.getElementById(`option-${i}-2`).value,
                        document.getElementById(`option-${i}-3`).value
                    ],
                    correctAnswer: parseInt(document.querySelector(`input[name="correct-${i}"]:checked`).value),
                    explanation: document.getElementById(`explanation-${i}`).value
                };
                questions.push(question);
            }
            
            story.quiz.questions = questions;
            
            renderLevels();
            bootstrap.Modal.getInstance(document.getElementById('editQuizModal')).hide();
            
            showToast(`Quiz "${story.quiz.title}" updated successfully!`, 'success');
            
            // Sync with API if enabled
            if (apiSettings.syncOnSave) {
                sendDataToAPI(storyData, 'update-quiz')
                    .then(() => showToast('Changes synced with API', 'success'))
                    .catch(error => console.error('Sync failed:', error));
            }
        }

        function confirmDeleteStory(levelIndex, storyIndex) {
            const level = storyData.levels[levelIndex];
            const story = level.stories[storyIndex];
            
            document.getElementById('deleteConfirmationMessage').textContent = 
                `Are you sure you want to delete "${story.name}" from "${level.name}"?`;
            
            document.getElementById('confirmDeleteBtn').onclick = () => deleteStory(levelIndex, storyIndex);
            
            const modal = new bootstrap.Modal(document.getElementById('deleteConfirmationModal'));
            modal.show();
        }

        function deleteStory(levelIndex, storyIndex) {
            storyData.levels[levelIndex].stories.splice(storyIndex, 1);
            renderLevels();
            bootstrap.Modal.getInstance(document.getElementById('deleteConfirmationModal')).hide();
            
            showToast('Story deleted successfully!', 'success');
            
            // Sync with API if enabled
            if (apiSettings.syncOnSave) {
                sendDataToAPI(storyData, 'delete-story')
                    .then(() => showToast('Changes synced with API', 'success'))
                    .catch(error => console.error('Sync failed:', error));
            }
        }

        // Segment Management Functions
        function addSegmentInput() {
            const container = document.getElementById('segmentsContainer');
            const segmentIndex = container.children.length;
            
            const segmentHTML = `
                <div class="segment-input" id="segment-${segmentIndex}">
                    <h5 class="segment-title">
                        <i class="bi bi-file-text me-2"></i>Segment ${segmentIndex + 1}
                    </h5>
                    <div class="mb-3">
                        <label for="segmentTitle-${segmentIndex}" class="form-label">Segment Title</label>
                        <input type="text" class="form-control" id="segmentTitle-${segmentIndex}" required>
                    </div>
                    <div class="mb-3">
                        <label for="segmentImage-${segmentIndex}" class="form-label">Segment Image URL</label>
                        <input type="url" class="form-control" id="segmentImage-${segmentIndex}" required>
                    </div>
                    <div class="mb-3">
                        <label for="segmentAudio-${segmentIndex}" class="form-label">Segment Audio URL</label>
                        <input type="url" class="form-control" id="segmentAudio-${segmentIndex}" required>
                    </div>
                    <div class="mb-3">
                        <label for="segmentDuration-${segmentIndex}" class="form-label">Duration (e.g., 2:30)</label>
                        <input type="text" class="form-control" id="segmentDuration-${segmentIndex}" required>
                    </div>
                    <div class="mb-3">
                        <label for="segmentContent-${segmentIndex}" class="form-label">Content</label>
                        <textarea class="form-control" id="segmentContent-${segmentIndex}" rows="3" required></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="segmentArabic-${segmentIndex}" class="form-label">Arabic Translation</label>
                        <textarea class="form-control" id="segmentArabic-${segmentIndex}" rows="3" required></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="segmentFrench-${segmentIndex}" class="form-label">French Translation</label>
                        <textarea class="form-control" id="segmentFrench-${segmentIndex}" rows="3" required></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Word Translations</label>
                        <div id="wordTranslations-${segmentIndex}">
                            <div class="word-translation">
                                <div class="word-translation-title">Word 1</div>
                                <div class="row">
                                    <div class="col-md-4 mb-2">
                                        <input type="text" class="form-control" placeholder="Word" id="word-${segmentIndex}-0">
                                    </div>
                                    <div class="col-md-4 mb-2">
                                        <input type="text" class="form-control" placeholder="Arabic Translation" id="wordArabic-${segmentIndex}-0">
                                    </div>
                                    <div class="col-md-4 mb-2">
                                        <input type="text" class="form-control" placeholder="French Translation" id="wordFrench-${segmentIndex}-0">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <button type="button" class="btn btn-sm btn-outline-secondary mt-2" onclick="addWordTranslation(${segmentIndex})">
                            <i class="bi bi-plus-circle"></i> Add Word Translation
                        </button>
                    </div>
                    ${segmentIndex > 0 ? `<button type="button" class="btn btn-sm btn-outline-danger mt-2" onclick="removeSegmentInput(${segmentIndex})">Remove Segment</button>` : ''}
                </div>
            `;
            
            container.insertAdjacentHTML('beforeend', segmentHTML);
        }

        function addWordTranslation(segmentIndex) {
            const container = document.getElementById(`wordTranslations-${segmentIndex}`);
            const wordIndex = container.children.length;
            
            const wordHTML = `
                <div class="word-translation">
                    <div class="word-translation-title">Word ${wordIndex + 1}</div>
                    <div class="row">
                        <div class="col-md-4 mb-2">
                            <input type="text" class="form-control" placeholder="Word" id="word-${segmentIndex}-${wordIndex}">
                        </div>
                        <div class="col-md-4 mb-2">
                            <input type="text" class="form-control" placeholder="Arabic Translation" id="wordArabic-${segmentIndex}-${wordIndex}">
                        </div>
                        <div class="col-md-4 mb-2">
                            <input type="text" class="form-control" placeholder="French Translation" id="wordFrench-${segmentIndex}-${wordIndex}">
                        </div>
                    </div>
                </div>
            `;
            
            container.insertAdjacentHTML('beforeend', wordHTML);
        }

        function removeSegmentInput(index) {
            const segment = document.getElementById(`segment-${index}`);
            segment.remove();
        }

        // Utility Functions
        function playStory(levelName, storyName) {
            showToast(`Playing ${storyName} from ${levelName}`, 'success');
        }

        function takeQuiz(levelName, storyName) {
            showToast(`Starting quiz for ${storyName} from ${levelName}`, 'info');
        }

        function saveChanges() {
            showToast('Changes saved! This update will be reflected in your app.', 'success');
            
            // Sync with API if enabled
            if (apiSettings.syncOnSave) {
                sendDataToAPI(storyData, 'save-changes')
                    .then(() => showToast('Changes synced with API', 'success'))
                    .catch(error => console.error('Sync failed:', error));
            }
        }

        function exportJSON() {
            const dataStr = JSON.stringify(storyData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = 'story_data.json';
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showToast('JSON exported successfully!', 'success');
        }

        function importJSON() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = e => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = event => {
                    try {
                        const importedData = JSON.parse(event.target.result);
                        storyData = importedData;
                        renderLevels();
                        showToast('JSON imported successfully!', 'success');
                        
                        // Sync with API if enabled
                        if (apiSettings.syncOnSave) {
                            sendDataToAPI(storyData, 'import-data')
                                .then(() => showToast('Imported data synced with API', 'success'))
                                .catch(error => console.error('Sync failed:', error));
                        }
                    } catch (error) {
                        showToast('Error importing JSON: ' + error.message, 'error');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function resetData() {
            if (confirm('Are you sure you want to reset all data? This action cannot be undone.')) {
                location.reload();
            }
        }

        function openAddLevelModal() {
            document.getElementById('addLevelForm').reset();
            const modal = new bootstrap.Modal(document.getElementById('addLevelModal'));
            modal.show();
        }

        function openAddStoryModal() {
            document.getElementById('addStoryForm').reset();
            document.getElementById('segmentsContainer').innerHTML = '';
            
            // Add initial segment
            addSegmentInput();
            
            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('addStoryModal'));
            modal.show();
        }

        function openTranslationSettings() {
            showToast('Translation settings feature coming soon!', 'info');
        }

        // Initialize the dashboard
        document.addEventListener('DOMContentLoaded', function() {
            renderLevels();
            loadApiSettings();
        });
    </script>
</body>
</html>

